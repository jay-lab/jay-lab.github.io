---
layout: single
title: "MongoDB - 04"
categories: MONGODB
# tag: python
tag: [MONGODB]
toc: true
toc_label: "Contents" # toc 제목
toc_icon: "cog" # toc 아이콘(톱니바퀴)
author_profile: false
classes: wide
sidebar:
    nav: "docs"


---



**MongoDB** 
<br> → 트랜잭션 명령어, 비교연산자
{: .notice--info}

<br>

### 트랜잭션 명령어

```javascript
session = db.getMongo().startSession()
session.startTransaction({
  readConcern: { level: "snapshot"},
  writeConcern: {w:"majorityu"}
})

<원하는 작업 수행>

session.commitTransaction();
session.endSession();
```

샤딩된 환경에서의 트랜잭션은 4.2버전 이상부터 가능

WriteConcern과 ReadConcern값을 startTransaction 실행시 제대로 설정해주서야 문제가 발생하더라고 손실피해를 줄일 수 있음

트랜잭션은 도큐먼트 생성, 읽기, 수정, 삭제시 가능하지만 그 외 명령어는 불가능(예:컬렉션 생성 및 삭제)

<br>

### 비교연산자

- $eq
  (equals) 주어진 값과 일치하는 값
- $ne
  (not equals) 주어진 값과 일치하지 않는 값
- $gt
  (greater than) 주어진 값보다 큰 값
- $gte
  (greater than or equals) 주어진 값보다 크거나 같은 값
- $lt
  (less than) 주어진 값보다 작은 값
- $lte
  (less than or equals) 주어진 값보다 작거나 같은 값
- $in
  주어진 배열 안에 속하는 값
- $nin
  (not in) 주어진 배열안에 속하지 않는 값

```javascript
// 사용예시 1
/* 키는 180 이상이면서 몸무게는 60킬로그램 이하인 사람 필터링 */
{height: {$gte:180}, weight: {$lte:60}}


// 사용예시 2 ($and, $or, $nor)
{ $or: [
    {status:"A"},
    {qty:{$lt:30}}
	]
}
```

 

사실 $or 혹은 $nor 연산자는 사용할 일이 종종 있지만, $and 연산자는 사용할 일이 흔치 않다.

그 이유는 이러한 논리연산자를 사용하지 않고도 간단하게 표현할 수 있기 때문.

```javascript
db.inventory.find({
  $and: [
    {qty: {$gt:10}},
    {qty: {$lt:100}}
  ]
})

↓ 더 간단하게 표현한 방법 ↓

db.inventory.find({qty: {$gt:10, $lt:100}})
```



### 문자열 연산자

- $regex

형식이 3가지

```javascript
// 첫번째 형식
{<filed>: {$regex: /pattern/, $optiojns: '<options>'}}

// 두번째 형식
{<filed>: {$regex: 'pattern', $optiojns: '<options>'}}

// 세번째 형식
{<filed>: {$regex: /pattern/<options>}}
```

<options>에 들어갈 수 있는 옵션의 종류는 4가지.

- i - 대소문자 무시
- m - 정규식에 앵커(^) 사용시 값에 \n이 있다면 무력화
- x - 정규. 안에 있는공백 모두 무시
- s - 점(.) 사용시 \n을 포함해서 매치

정규식 하나로 검색할때는 일반적으로 사용하지 않음. 그 이유는 $regex를 사용하지 않고도 표현할 수 있기 때문.  
예시) `db.articles.find( {"title": /article0[1-9]i/} )`

$regex를 사용하는 경우는 '여러 연산자'를 적용하려고 할 때 활용.

```javascript
db.articles.find({
  title: { %regex: /aricle0[1-9]/i, $not: /aricle03/}
})
```



