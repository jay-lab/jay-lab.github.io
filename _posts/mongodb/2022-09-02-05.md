---
layout: single
title: "MongoDB - 05"
categories: MONGODB
# tag: python
tag: [MONGODB]
toc: true
toc_label: "Contents" # toc 제목
toc_icon: "cog" # toc 아이콘(톱니바퀴)
author_profile: false
classes: wide
sidebar:
    nav: "docs"
---



**MongoDB** 
<br> → 배열 연산자
{: .notice--info}

<br>

# 배열 연산자

### 배열 기본 검색

- 테스트 데이터 구성

```javascript
db.inventory.insertMany([
  { item : "journal", qty : 25, tags : ["blank", "red"]},
  { item : "notebook", qty : 50, tags : ["red", "blank"]},
  { item : "paper", qty : 100, tags : },
	{ item : "planer", qty : 75, tags : ["blank", "red"]},
	{ item : "postcard", qty : 45, tags : ["blue"]},
]);
```

<br>

- 단일 요소 기본 검색

```javascript
db.inventory.find({tags:"red"}, {_id:false})

// 결과
{"item" : "journal", "qty" : 25, "tags" : ["blank", "red"]}
{"item" : "notebook", "qty" : 50, "tags" : ["red", "blank"]}
{"item" : "paper", "qty" : 100, "tags" : ["red", "blank", "plain"]}
{"item" : "plnner", "qty" : 75, "tags" : ["blank", "red"]}
```

※ red 문자열이 들어있는 도큐먼트가 모두 검색되었음

<br>

### $all

- 요소 두개 검색 - 별도 옵션이 없으면 입력한 요소를 입력한 순서 그대로 모두 포함하는 도큐먼트 검색

```javascript
db.inventory.find({tags : ["red", "blank"]}, {_id:false})

// 결과
{"item" : "notebook", "qty" : 50, "tags" : ["red", "blank"]}
```

순서에 상관없이 입력한 요소를 모두 포함하는 도큐먼트를 검색하고자할 때 $all 오퍼레이터 사용

```javascript
db.inventory.find({tags : { $all : ["red", "blank"]} }, {_id:false})

// 결과
{"item" : "journal", "qty" : 25, "tags" : ["blank", "red"]}
{"item" : "notebook", "qty" : 50, "tags" : ["red", "blank"]}
{"item" : "paper", "qty" : 100, "tags" : ["red", "blank", "plain"]}
{"item" : "plnner", "qty" : 75, "tags" : ["blank", "red"]}
```

의미를 생각해보면, $and 연산자로도 동일한 값을 얻을 수 있다.

```javascript
{ <field> : { $all :[ <value1>, <value2>, ...] }
{ $and : [{<filed1>:<value1>}, {<filed2>:<value2>}, ...] }
```

<br>

### $elemMatch

- 두 가지 조건을 동시에 만족하는 요소가 있는 도큐먼트 검색
  예시) 5 보다 크고 10 보다 작은 요소가 하나라도 있는 도큐먼트 검색

```javascript
db.inventory.find({ tags : {$elemMatch : { $gt : 5, $lt : 10 } } })
```

만약 $elemMatch 연산자를 사용하지 않고

`db.inventory.find({ tags : { $gt : 5, $lt : 10 } })`로 검색하게되면 5보다 큰 요소가 하나라도 있고 10보다 작은 요소가 하나라도 있으면 검색결과에 포함된다(예시: [15,1])



- elemMatch, all 연산자를 응용한 쿼리

```javascript
db.example.find({
  stock : {
    $all : [
      { $elemMatch : { size : "M", num : { $ge: 50} } },
      { $elemMatch : { num : 100, color : "green" } },
    ]
  }
})
```

<br>

### $size

배열이 해당크기와 같은 도큐먼트 검색

```javascript
db.inventory.find({ "tags" : { $size : 3 } }, { _id : false })

// 결과
{ "item" : "paper", "qty" : 100, "tags" : ["red", "blank", "plain"] }
```

